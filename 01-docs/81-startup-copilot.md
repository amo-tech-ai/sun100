# ðŸ¤– AI Startup Coach: Implementation Plan & Architecture

**Document Status:** âœ… Implemented - 2025-01-23
**Author:** Lead AI Architect & Product Strategist
**System Goal:** To implement a proactive, always-on "AI Startup Coach" powered by **Google Gemini 3 Pro**.

The AI Coach will analyze startup metrics, CRM activity, fundraising progress, user growth, financials, and product usage to deliver insights, alerts, recommendations, and investor-ready guidance. It acts as an "Always-On Venture Partner."

---

### ðŸ“Š Implementation Progress Tracker

| Phase | Task | Status | % Complete |
| :--- | :--- | :---: | :---: |
| **1. Data & Schema** | Define `ai_coach_insights` & `ai_recommendation_actions` tables | âœ… | 100% |
| | Define RLS policies & Indexes | âœ… | 100% |
| | Implement `get_startup_context` helper function (SQL/RPC) | âœ… | 100% |
| **2. AI Engine** | Create `generate-coach-insights` Edge Function | âœ… | 100% |
| | Integrate Gemini 3 Pro with Thinking & Search Grounding | âœ… | 100% |
| | Design "Venture Partner" Prompt & JSON Schemas | âœ… | 100% |
| **3. Frontend UI** | Build `StartupCoachSidebar` Component | âœ… | 100% |
| | Implement Insight Cards & Action Handlers | âœ… | 100% |
| **4. Integration** | Connect Dashboard to Coach Engine | âœ… | 100% |
| | Implement Caching & Refresh Logic | âœ… | 100% |

---

## 1. Purpose & Philosophy

**Role:** The AI Coach is not just a chatbot; it is a proactive analyst. It runs in the background (or on demand), digests all available data points about the startup, and surfaces the most critical information a founder needs to know *right now*.

**Core Value:**
*   **Proactive:** Don't wait for the user to ask. Tell them what they missed.
*   **Holistic:** Connects dots between Finance (Burn rate) and Sales (Pipeline) to give strategic advice.
*   **Venture-Grade:** Uses the reasoning capabilities of Gemini 3 to simulate the advice of a seasoned VC partner.

---

## 2. Feature Set

1.  **Strategic Insights Feed:**
    *   "Momentum is building" (Pipeline velocity analysis).
    *   "Marketing ROI is above industry average" (Benchmarking).
2.  **Critical Alerts:**
    *   "Runway is nearing 6 months."
    *   "3 Key Accounts are at risk of churn."
3.  **Actionable Recommendations:**
    *   "Update your Traction Slide" (Based on new metric data).
    *   "Follow up with Lightspeed" (CRM inactivity detection).
4.  **Fundraising Guidance:**
    *   Investor matching score changes.
    *   Pitch deck narrative gaps.
5.  **Market Intelligence:**
    *   "Competitor X just raised Series B" (Search Grounding).
    *   "New regulation affects your sector."

---

## 3. Data Inputs (The Context Window)

To function effectively, the AI needs a comprehensive view of the startup. We aggregate this via `get_startup_context`.

| Source | Data Points |
| :--- | :--- |
| **CRM** | Active deals, pipeline value, recent interactions, stale leads. |
| **Financials** | MRR, burn rate, cash balance, runway months (calculated). |
| **Growth** | Active users, churn rate, new signups. |
| **Fundraising** | Target investors, application status, deck version history. |
| **External** | Google Search (Market trends, Competitor news). |

---

## 4. AI Models & Configuration

*   **Model:** `gemini-3-pro-preview`
*   **Thinking Config:** `thinkingBudget: 2048` (Required for complex reasoning across disparate data sources).
*   **Tools:** `googleSearch` (For market validation and competitor checks).
*   **Format:** JSON Structured Output (Strict Schema).

---

## 5. System Architecture

### Database Schema (Supabase / PostgreSQL)

#### Table: `ai_coach_insights`
Stores the latest generated analysis for a startup to avoid re-running expensive AI calls on every page load.

```sql
CREATE TABLE public.ai_coach_insights (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    startup_id uuid NOT NULL REFERENCES public.startups(id) ON DELETE CASCADE,
    payload jsonb NOT NULL, -- The JSON output from Gemini
    created_at timestamptz NOT NULL DEFAULT now(),
    updated_at timestamptz NOT NULL DEFAULT now(),
    UNIQUE(startup_id)
);
```

#### Table: `ai_recommendation_actions`
Tracks the user's interaction with specific advice (e.g., "Dismissed", "Completed").

```sql
CREATE TABLE public.ai_recommendation_actions (
    id uuid PRIMARY KEY DEFAULT gen_random_uuid(),
    startup_id uuid NOT NULL REFERENCES public.startups(id) ON DELETE CASCADE,
    action_id text NOT NULL, -- Correlates with the ID generated by AI
    status text NOT NULL CHECK (status IN ('pending', 'completed', 'dismissed')),
    interacted_at timestamptz DEFAULT now(),
    UNIQUE(startup_id, action_id)
);
```

#### RPC: `get_startup_context`
A highly efficient SQL function to gather all necessary context into a single JSON blob for the LLM.

```sql
CREATE OR REPLACE FUNCTION public.get_startup_context(target_startup_id uuid)
RETURNS jsonb AS $$
  -- Aggregates profile, financials, CRM stats, and deck info
  -- (See implementation in migration file)
$$ LANGUAGE plpgsql;
```

### Edge Function: `generate-coach-insights`

**Workflow:**
1.  **Auth:** Validate User JWT.
2.  **Context:** Call `get_startup_context(startup_id)`.
3.  **Prompting:** Construct the "Venture Partner" system prompt with the JSON context.
4.  **Inference:** Call Gemini 3 Pro with Thinking & Search.
5.  **Validation:** Ensure output matches the `CoachResponse` schema.
6.  **Persistence:** Upsert result into `ai_coach_insights`.
7.  **Response:** Return JSON to client.

---

## 6. AI Prompts & Schemas

### System Prompt
> "You are an expert Venture Partner and Startup Coach. Your goal is to analyze raw startup data and synthesize it into strategic insights.
>
> **Reasoning Rules:**
> 1. **Connect the Dots:** Don't just report numbers. Explain *why* (e.g. 'Revenue up, but churn up -> Fix bucket').
> 2. **Be Direct:** Executive-level language. No fluff.
> 3. **Prioritize:** Only report significant deviations.
> 4. **External Context:** Use Google Search to check market trends against these metrics."

### Output JSON Schema (`CoachResponse`)
```json
{
  "insights": [
    {
      "type": "positive" | "negative" | "neutral",
      "category": "growth" | "finance" | "fundraising",
      "title": "Momentum is building",
      "description": "You've moved 2 applications to 'Interview' stage...",
      "metric_highlight": "+15%"
    }
  ],
  "alerts": [
    {
      "severity": "high" | "medium",
      "message": "Update your Traction Slide",
      "subtext": "Sequoia often looks for MoM growth..."
    }
  ],
  "recommendations": [
    {
      "action_id": "follow_up_lightspeed",
      "label": "Follow up with Lightspeed",
      "reason": "It's been 5 days since your last email."
    }
  ],
  "match_score": 92
}
```

---

## 7. UI/UX Layout (`StartupCoachSidebar`)

**Design Philosophy:**
*   **Location:** Right sidebar on the Dashboard (persistent or toggleable).
*   **Visuals:** Clean, card-based layout. Use specific colors for sentiment (Green/Red/Blue).
*   **Interactivity:**
    *   **Refresh:** Button to trigger a new analysis.
    *   **Dismiss:** "X" button on recommendations to hide them.
    *   **Action:** "Apply" buttons that deep-link to relevant tools (e.g., open Deck Editor).

**Sections:**
1.  **Header:** "AI Coach" + Last Updated timestamp.
2.  **Insights:** Top-level cards summarizing the state of the union.
3.  **Suggestions:** Actionable list of to-dos.
4.  **Recommended:** Investor matches or specific resource links.

---

## 8. Implementation Roadmap

### Week 1: Data Layer (Complete)
- [x] Create DB Tables.
- [x] Write Context Aggregation RPC.
- [x] Set up RLS.

### Week 2: AI Engine (Complete)
- [x] Build Edge Function.
- [x] Integrate Gemini 3 SDK.
- [x] prompt engineering & schema validation.

### Week 3: Frontend (Complete)
- [x] Create `StartupCoachSidebar` component.
- [x] Integrate `coachService` for API calls.
- [x] Add interactions (Refresh, Dismiss).

### Week 4: Polish & Launch (Next)
- [ ] Add "Deep Linking" (Clicking an insight takes you to the relevant page).
- [ ] Implement "Streaming" response for better UX if latency is high.
- [ ] Add "Feedback" mechanism (Thumbs up/down on insights).

---

## 9. Success Criteria

*   **Insight Accuracy:** Do founders find the insights relevant? (Measured via click-through rate on actions).
*   **Performance:** Generation time under 10 seconds (Gemini 3 Thinking can be slow, need to manage expectations or cache aggressively).
*   **Engagement:** Daily Active Usage of the Coach sidebar.
